# KODEON Debugging Guide

This document explains how to use the debugging features in the KODEON programming language compiler.

## Overview

KODEON provides comprehensive debugging support to help developers identify and fix issues in their programs. The debugging system includes:

1. Enhanced debug information generation
2. Source-level debugging with breakpoints
3. Variable inspection capabilities
4. Interactive debugging interface
5. Advanced features like watchpoints and conditional breakpoints

## Using the Debugger

To use the KODEON debugger, compile your program with the `--debug` flag:

```bash
kodeonc program.kodeon --debug
```

This will start the interactive debugger instead of generating executable code.

## Debugger Commands

The KODEON debugger supports the following commands:

### Breakpoint Management

-   `break <file> <line>` or `b <file> <line>` - Set breakpoint at line
-   `delete <file> <line>` or `d <file> <line>` - Delete breakpoint at line
-   `condition <file> <line> <condition>` - Set conditional breakpoint

### Execution Control

-   `run` or `r` - Start program execution
-   `continue` or `c` - Continue execution
-   `step` or `s` - Step to next line
-   `next` or `n` - Step over function calls

### Information Display

-   `print [<variable>]` or `p [<variable>]` - Print variable value or all variables
-   `list` or `l` - Show source code
-   `backtrace` or `bt` - Show call stack
-   `info [breakpoints|variables|functions|watchpoints]` - Show program information

### Advanced Features

-   `watch <variable>` - Watch variable for changes
-   `watch <variable> condition <condition>` - Set conditional watchpoint
-   `delete <variable>` - Delete watchpoint
-   `eval <expression>` - Evaluate expression
-   `quit` or `q` - Exit debugger
-   `help` or `h` - Show help

## Example Debugging Session

Here's an example of how to debug a simple KODEON program:

```kodeon
fungsi utama() {
    angka x = 10;
    angka y = 20;
    angka hasil = x + y;
    kembalikan hasil;
}
```

To debug this program:

1. Save it as `example.kodeon`
2. Run the debugger: `kodeonc example.kodeon --debug`
3. Set a breakpoint: `break example.kodeon 3`
4. Run the program: `run`
5. When the breakpoint is hit, inspect variables: `print x`
6. Continue execution: `continue`

## Debug Information in Generated Code

When compiling without the debug flag, the KODEON compiler generates enhanced debug information in the LLVM IR, including:

-   Source file and line number mapping
-   Variable scope information
-   Function and module context
-   Type information for all values

This information is used by debuggers and profiling tools to provide detailed insights into program execution.

## Advanced Debugging Features

### Conditional Breakpoints

You can set breakpoints that only trigger when a specific condition is met:

```
condition program.kodeon 10 x > 5
```

### Variable Watching

Watch variables for changes during program execution:

```
watch counter
```

You can also set conditional watchpoints:

```
watch counter condition counter > 100
```

### Expression Evaluation

Evaluate expressions in the current context:

```
eval x + y * 2
```

## Integration with External Tools

The enhanced debug information generated by the KODEON compiler is compatible with standard debugging tools like GDB and LLDB when used with the generated LLVM IR or compiled binaries.

## Troubleshooting

If you encounter issues with debugging:

1. Ensure your source files have proper line endings
2. Check that the file paths in breakpoint commands are correct
3. Verify that the program compiles without errors before debugging
4. Make sure you're using the `--debug` flag when you want to start the debugger

## Future Enhancements

The KODEON debugging system is continuously evolving. Future enhancements will include:

-   Graphical debugging interface
-   Remote debugging support
-   Memory profiling tools
-   Performance analysis features

## Technical Implementation Details

### Enhanced DebugInfo Structure

The KODEON compiler uses an enhanced DebugInfo structure that includes:

```rust
pub struct DebugInfo {
    pub file_name: String,
    pub line: usize,
    pub column: usize,
    pub scope: Option<String>,        // Variable scope information
    pub function: Option<String>,     // Function name
    pub module: Option<String>,       // Module name
    pub timestamp: std::time::SystemTime, // When this debug info was created
}
```

### Debugger Architecture

The debugger is implemented as a modular system with the following components:

1. **Debugger Core** - Main debugging logic and state management
2. **Breakpoint Manager** - Handles breakpoint creation, deletion, and evaluation
3. **Watchpoint Manager** - Manages variable watching and change detection
4. **Variable Inspector** - Provides variable inspection and type information
5. **Command Processor** - Processes user commands and provides responses

### Integration with IR Generation

The debugging features are deeply integrated with the IR generation process:

1. Debug information is embedded in all IR structures
2. LLVM backend generates detailed debug metadata
3. Variable tracking is maintained throughout compilation
4. Source mapping is preserved for all instructions

## Testing and Quality Assurance

The debugging system includes comprehensive unit tests that cover:

1. Breakpoint management
2. Variable inspection
3. Watchpoint functionality
4. Conditional breakpoint evaluation
5. Command processing
6. Integration with IR generation

## Performance Considerations

The debugging features are designed to have minimal impact on normal compilation:

1. Debug information is only generated when requested
2. Runtime overhead is negligible in non-debug builds
3. Memory usage is optimized for large programs
4. Efficient data structures for breakpoint and watchpoint management

## Conclusion

The KODEON debugging system provides powerful tools for developers to understand and fix issues in their programs. With comprehensive breakpoint support, variable inspection, and advanced features like watchpoints, developers can efficiently debug their KODEON programs. The system is designed to be extensible and will continue to evolve with new features and capabilities.
